{% set random_number = ''|random_number %}
<div class="woody-component woody-component-geomap tpl_01">
    <script>
    var mapData = {
        id: "geomap-{{ random_number }}",
            default: {
                lat: {{ default_lat }},
                lng: {{ default_lng }},
                zoom: {{ map_zoom|default(7) }},
                fitBounds: {{ map_zoom_auto|default('true') }},
                tm_conf_id : {{ tmaps_confid|default('false') }},
                controls: {
                    "fullScreenControl": true,
                    "zoomControl": true,
                    "zoomControlPosition": "topright",
                    "layerControl": true
                }
            },
            {% if markers|default %}
                markers: [
                    {% for marker in markers %}
                        {% if marker.map_position|default %}
                            {
                                lat: {{ marker.map_position.lat }},
                                lng: {{ marker.map_position.lng }},
                                customMarker: "{{ marker.compiled_marker|e('js') }}",
                                html: "{{ marker.marker_thumb_html|default|e('js') }}"
                            },
                        {% endif %}
                    {% endfor %}
                ]
            {% endif %}
        }

        {% if routes %}
            var rcModule = rcModule || {};
            rcModule.GeoJSONFiles = rcModule.GeoJSONFiles || {};
            rcModule.GeoJSONFiles[mapData['id']] = [];

            {% for route in routes %}
                rcModule.GeoJSONFiles[mapData['id']].push({{route}});
            {% endfor %}
        {% endif %}

        if(!window.ExtendedMarkersV2){
            window.ExtendedMarkersV2 = [];
        }
        ExtendedMarkersV2.push(mapData);

        var setPropertiesToLayer = function(){
            if(document.getElementsByClassName('leaflet-map-pane').length == 0) {
                setTimeout(setPropertiesToLayer, 1000);
            }else{
                rcModule.rcTouristicMap[mapData['id']].eachLayer(function(e){
                    if('feature' in e && 'route' in e['feature']){
                        let stroke_color = e['feature']['properties']['stroke'];
                        let fill_color = e['feature']['properties']['fill'];
                        let opacity = e['feature']['properties']['fill-opacity'];
                        let weight = e['feature']['properties']['stroke-width'];
                        e.setStyle({
                            color: stroke_color,
                            fillColor: fill_color,
                            fillOpacity: opacity,
                            weight: weight
                        });
                    }
                });
            }
        };
        setPropertiesToLayer();

    </script>
    <div class="map-wrapper">
        <div id="geomap-{{ random_number }}" class="geomap-{{ map_height }}" style="height:80vh;"></div>
    </div>
</div>
